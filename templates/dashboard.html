<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AgroBot Dashboard</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
        }
        .header {
            background: #224a2b;
            padding: 20px;
            color: white;
            font-size: 24px;
            text-align: center;
            position: relative;
        }
        .logout {
            position: absolute;
            right: 20px;
            top: 20px;
            background: rgb(100, 158, 134);
            padding: 8px 12px;
            border-radius: 6px;
            text-decoration: none;
            color: #fff;
            font-weight: bold;
        }

        .main-container {
            display: flex;
            justify-content: center;
            padding: 20px;
        }
        .box {
            width: 60%;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 12px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0;
            padding: 15px;
            background: #0d4d2c;
            color: white;
            border-radius: 10px 10px 0 0;
        }

        .box h2 {
            margin: 0;
            padding: 0;
            background: transparent;
            color: white;
            text-align: left;
            font-weight: bold;
            font-size: 24px;
        }

        .language-selector {
            width: 150px;
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
            color: #333;
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: 550px;
        }
        .chat-box {
            flex-grow: 1;
            overflow-y: auto;
            border: 1px solid #cccccc;
            padding: 0;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .chat-input-form {
            display: flex;
            width: 100%;
        }

        .chat-input {
            flex-grow: 1;
            padding: 10px;
            border-radius: 20px;
            border: 1px solid #ccc;
            margin-right: 10px;
            outline: none;
            font-size: 16px;
        }

        .chat-send-button,
        .chat-image-button {
            width: 45px;
            height: 45px;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 22px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .chat-image-button {
            background: #1d6f45;
            margin-right: 10px;
        }

        .chat-send-button {
            background: #0d4d2c;
            font-size: 20px;
            font-weight: bold;
        }

        .chat-image-button i {
            color: white;
        }

        .user-msg {
            background: #d1e7ff;
            padding: 8px 12px;
            border-radius: 18px 18px 2px 18px;
            margin: 8px 0;
            margin-left: auto;
            max-width: 80%;
            margin-right: 10px;
        }
        .bot-msg {
            background: #e7ffe7;
            padding: 8px 12px;
            border-radius: 18px 18px 18px 2px;
            margin: 8px 0;
            margin-right: auto;
            max-width: 80%;
            white-space: pre-wrap;
            margin-left: 10px;
        }
    </style>
</head>

<body>

<div class="header">
    Welcome, {{ user }}
    <a class="logout" href="{{ url_for('logout') }}">Logout</a>
</div>

<div class="main-container">
    <div class="box">

        <div class="header-content">
            <h2>ðŸ¤– AgroBot</h2>

            <select id="languageSelector" class="language-selector" onchange="changeLanguage(this.value)">
            </select>
        </div>

        <div class="chat-container">

            <div class="chat-box" id="chatBox">
                <p class="bot-msg" id="greetingMsg">Hello! I'm your smart agricultural assistant, here to help you diagnose plant problems,understand symptoms, and get the best solutions for keeping your crops healthy.How can I support you today?</p>
            </div>

            <form id="chatForm" class="chat-input-form" onsubmit="event.preventDefault(); sendChat()">
                <input id="userMessage" class="chat-input" type="text" placeholder="Ask AgroBot...">

                <label class="chat-image-button">
                    <i class="fa-solid fa-paperclip"></i>
                    <input type="file" id="chatImage" accept="image/*" style="display:none" onchange="sendImage()">
                </label>

                <div class="chat-send-button" onclick="sendChat()">></div>
            </form>

        </div>
    </div>
</div>

<script>

// AVAILABLE LANGUAGES
const LANGUAGES = [
    { code: "en", name: "English" },
    { code: "hi", name: "Hindi (à¤¹à¤¿à¤‚à¤¦à¥€)" },
    { code: "bn", name: "Bengali (à¦¬à¦¾à¦‚à¦²à¦¾)" },
    { code: "mr", name: "Marathi (à¤®à¤°à¤¾à¤ à¥€)" },
    { code: "te", name: "Telugu (à°¤à±†à°²à±à°—à±)" },
    { code: "ta", name: "Tamil (à®¤à®®à®¿à®´à¯)" },
    { code: "gu", name: "Gujarati (àª—à«àªœàª°àª¾àª¤à«€)" },
    { code: "ur", name: "Urdu (Ø§Ø±Ø¯Ùˆ)" },
    { code: "kn", name: "Kannada (à²•à²¨à³à²¨à²¡)" },
    { code: "or", name: "Odia (à¬“à¬¡à¬¼à¬¿à¬†)" },
    { code: "ml", name: "Malayalam (à´®à´²à´¯à´¾à´³à´‚)" },
    { code: "pa", name: "Punjabi (à¨ªà©°à¨œà¨¾à¨¬à©€)" },
    { code: "as", name: "Assamese (à¦…à¦¸à¦®à§€à¦¯à¦¼à¦¾)" },
    { code: "mai", name: "Maithili (à¤®à¥ˆà¤¥à¤¿à¤²à¥€)" },
    { code: "sat", name: "Santali (á±¥á±Ÿá±±á±›á±Ÿá±²á±¤)" },
    { code: "ks", name: "Kashmiri (Ú©Ù²Ø´ÙØ±)" },
    { code: "ne", name: "Nepali (à¤¨à¥‡à¤ªà¤¾à¤²à¥€)" },
    { code: "sd", name: "Sindhi (Ø³Ù†ÚŒÙŠ)" },
    { code: "doi", name: "Dogri (à¤¡à¥‹à¤—à¤°à¥€)" },
    { code: "kok", name: "Konkani (à¤•à¥‹à¤‚à¤•à¤£à¥€)" },
    { code: "mni", name: "Meitei (ê¯ƒê¯¤ê¯‡ê¯©)" },
    { code: "ar", name: "Arabic (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)" },
    { code: "brx", name: "Bodo (à¤¬à¤°')" },
    { code: "sa", name: "Sanskrit (à¤¸à¤‚à¤¸à¥à¤•à¥ƒà¤¤à¤®à¥)" }
];

// TRANSLATED GREETINGS
const TRANSLATIONS = {
    en: "Hello! I'm your smart agricultural assistant, here to help you diagnose plant problems, understand symptoms, and get the best solutions for keeping your crops healthy. How can I support you today?",

    hi: "à¤¨à¤®à¤¸à¥à¤¤à¥‡! à¤®à¥ˆà¤‚ à¤†à¤ªà¤•à¤¾ à¤¸à¥à¤®à¤¾à¤°à¥à¤Ÿ à¤•à¥ƒà¤·à¤¿ à¤¸à¤¹à¤¾à¤¯à¤• à¤¹à¥‚à¤, à¤œà¥‹ à¤ªà¥Œà¤§à¥‹à¤‚ à¤•à¥€ à¤¸à¤®à¤¸à¥à¤¯à¤¾à¤“à¤‚ à¤•à¤¾ à¤ªà¤¤à¤¾ à¤²à¤—à¤¾à¤¨à¥‡, à¤²à¤•à¥à¤·à¤£ à¤¸à¤®à¤à¤¨à¥‡ à¤”à¤° à¤†à¤ªà¤•à¥€ à¤«à¤¸à¤²à¥‹à¤‚ à¤•à¥‹ à¤¸à¥à¤µà¤¸à¥à¤¥ à¤°à¤–à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤¸à¤°à¥à¤µà¥‹à¤¤à¥à¤¤à¤® à¤¸à¤®à¤¾à¤§à¤¾à¤¨ à¤¦à¥‡à¤¤à¤¾ à¤¹à¥‚à¤à¥¤ à¤®à¥ˆà¤‚ à¤†à¤ªà¤•à¥€ à¤•à¥ˆà¤¸à¥‡ à¤®à¤¦à¤¦ à¤•à¤° à¤¸à¤•à¤¤à¤¾ à¤¹à¥‚à¤?",

    bn: "à¦¨à¦®à¦¸à§à¦•à¦¾à¦°! à¦†à¦®à¦¿ à¦†à¦ªà¦¨à¦¾à¦° à¦¸à§à¦®à¦¾à¦°à§à¦Ÿ à¦•à§ƒà¦·à¦¿ à¦¸à¦¹à¦¾à¦¯à¦¼à¦•, à¦—à¦¾à¦›à§‡à¦° à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦¨à¦¿à¦°à§à¦£à¦¯à¦¼ à¦•à¦°à¦¤à§‡, à¦²à¦•à§à¦·à¦£ à¦¬à§à¦à¦¤à§‡ à¦à¦¬à¦‚ à¦«à¦¸à¦²à¦•à§‡ à¦¸à§à¦¸à§à¦¥ à¦°à¦¾à¦–à¦¤à§‡ à¦¸à¦¹à¦¾à¦¯à¦¼à¦¤à¦¾ à¦•à¦°à¦¿à¥¤ à¦†à¦œ à¦†à¦ªà¦¨à¦¾à¦•à§‡ à¦•à§€à¦­à¦¾à¦¬à§‡ à¦¸à¦¾à¦¹à¦¾à¦¯à§à¦¯ à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à¦¿?",

    mr: "à¤¨à¤®à¤¸à¥à¤•à¤¾à¤°! à¤®à¥€ à¤¤à¥à¤®à¤šà¤¾ à¤¸à¥à¤®à¤¾à¤°à¥à¤Ÿ à¤•à¥ƒà¤·à¥€ à¤¸à¤¹à¤¾à¤¯à¥à¤¯à¤• à¤†à¤¹à¥‡, à¤ªà¤¿à¤•à¤¾à¤‚à¤šà¥à¤¯à¤¾ à¤¸à¤®à¤¸à¥à¤¯à¤¾ à¤“à¤³à¤–à¤£à¥à¤¯à¤¾à¤¤ à¤†à¤£à¤¿ à¤¸à¤°à¥à¤µà¥‹à¤¤à¥à¤¤à¤® à¤‰à¤ªà¤¾à¤¯ à¤¦à¥‡à¤£à¥à¤¯à¤¾à¤¤ à¤®à¤¦à¤¤ à¤•à¤°à¤¤à¥‹. à¤®à¥€ à¤¤à¥à¤®à¥à¤¹à¤¾à¤²à¤¾ à¤•à¤¶à¥€ à¤®à¤¦à¤¤ à¤•à¤°à¥‚ à¤¶à¤•à¤¤à¥‹?",

    te: "à°¨à°®à°¸à±à°¤à±‡! à°¨à±‡à°¨à± à°®à±€ à°¸à±à°®à°¾à°°à±à°Ÿà± à°µà±à°¯à°µà°¸à°¾à°¯ à°¸à°¹à°¾à°¯à°•à±à°¡à°¿à°¨à°¿. à°ªà°‚à°Ÿ à°¸à°®à°¸à±à°¯à°²à°¨à± à°—à±à°°à±à°¤à°¿à°‚à°šà°¿ à°ªà°°à°¿à°·à±à°•à°¾à°°à°¾à°²à°¨à± à°¸à±‚à°šà°¿à°¸à±à°¤à°¾à°¨à±. à°¨à±‡à°¨à± à°Žà°²à°¾ à°¸à°¹à°¾à°¯à°‚ à°šà±‡à°¯à°—à°²à°¨à±?",

    ta: "à®µà®£à®•à¯à®•à®®à¯! à®¨à®¾à®©à¯ à®‰à®™à¯à®•à®³à¯ à®¸à¯à®®à®¾à®°à¯à®Ÿà¯ à®µà¯‡à®³à®¾à®£à¯à®®à¯ˆ à®‰à®¤à®µà®¿à®¯à®¾à®³à®°à¯. à®¨à®¾à®©à¯ à®Žà®ªà¯à®ªà®Ÿà®¿ à®‰à®¤à®µà®²à®¾à®®à¯?",

    gu: "àª¨àª®àª¸à«àª¤à«‡! àª¹à«àª‚ àª¤àª®àª¾àª°à«‹ àª¸à«àª®àª¾àª°à«àªŸ àª•à«ƒàª·àª¿ àª¸àª¹àª¾àª¯àª• àª›à«àª‚. àª†àªœà«‡ àª¹à«àª‚ àª¤àª®àª¨à«‡ àª•à«‡àªµà«€ àª°à«€àª¤à«‡ àª®àª¦àª¦ àª•àª°à«€ àª¶àª•à«àª‚?",

    ur: "Ø³Ù„Ø§Ù…! Ù…ÛŒÚº Ø¢Ù¾ Ú©Ø§ Ø³Ù…Ø§Ø±Ù¹ Ø²Ø±Ø¹ÛŒ Ù…Ø¹Ø§ÙˆÙ† ÛÙˆÚºÛ” Ù…ÛŒÚº Ø¢Ù¾ Ú©ÛŒ Ú©ÛŒØ³Û’ Ù…Ø¯Ø¯ Ú©Ø±Ø³Ú©ØªØ§ ÛÙˆÚºØŸ",

    kn: "à²¨à²®à²¸à³à²•à²¾à²°! à²¨à²¾à²¨à³ à²¨à²¿à²®à³à²® à²¸à³à²®à²¾à²°à³à²Ÿà³ à²•à³ƒà²·à²¿ à²¸à²¹à²¾à²¯à²•à²¨à³. à²¨à²¾à²¨à³ à²¨à²¿à²®à²—à³† à²¹à³‡à²—à³† à²¸à²¹à²¾à²¯ à²®à²¾à²¡à²¬à²¹à³à²¦à³?",

    or: "à¬¨à¬®à¬¸à­à¬•à¬¾à¬°! à¬®à­à¬ à¬†à¬ªà¬£à¬™à­à¬• à¬¸à­à¬®à¬¾à¬°à­à¬Ÿ à¬•à­ƒà¬·à¬¿ à¬¸à¬¹à¬¾à­Ÿà¬•à¥¤ à¬®à­à¬ à¬†à¬œà¬¿ à¬•à¬¿à¬ªà¬°à¬¿ à¬†à¬ªà¬£à¬™à­à¬•à­ à¬¸à¬¹à¬¯à­‹à¬— à¬•à¬°à¬¿à¬ªà¬¾à¬°à­‡?",

    ml: "à´¨à´®à´¸àµà´•à´¾à´°à´‚! à´žà´¾àµ» à´¨à´¿à´™àµà´™à´³àµà´Ÿàµ† à´¸àµà´®à´¾àµ¼à´Ÿàµà´Ÿàµ à´•à´¾àµ¼à´·à´¿à´• à´¸à´¹à´¾à´¯à´¿. à´žà´¾àµ» à´Žà´™àµà´™à´¨àµ† à´¸à´¹à´¾à´¯à´¿à´•àµà´•à´¾à´‚?",

    pa: "à¨¸à¨¤ à¨¸à©à¨°à©€ à¨…à¨•à¨¾à¨²! à¨®à©ˆà¨‚ à¨¤à©à¨¹à¨¾à¨¡à¨¾ à¨¸à¨®à¨¾à¨°à¨Ÿ à¨–à©‡à¨¤à©€-à¨¬à¨¾à©œà©€ à¨¸à¨¹à¨¾à¨‡à¨• à¨¹à¨¾à¨‚à¥¤ à¨®à©ˆà¨‚ à¨¤à©à¨¹à¨¾à¨¡à©€ à¨•à¨¿à¨µà©‡à¨‚ à¨®à¨¦à¨¦ à¨•à¨° à¨¸à¨•à¨¦à¨¾ à¨¹à¨¾à¨‚?",

    as: "à¦¨à¦®à¦¸à§à¦•à¦¾à§°! à¦®à¦‡ à¦†à¦ªà§‹à¦¨à¦¾à§° à¦¸à§à¦®à¦¾à§°à§à¦Ÿ à¦•à§ƒà¦·à¦¿ à¦¸à¦¹à¦¾à¦¯à¦¼à¦•à¥¤ à¦†à¦ªà§‹à¦¨à¦¾à¦• à¦•à§‡à¦¨à§‡à¦•à§ˆ à¦¸à¦¹à¦¾à¦¯à¦¼ à¦•à§°à¦¿à¦¬ à¦ªà¦¾à§°à§‹à¦?",

    mai: "à¤¨à¤®à¤¸à¥à¤•à¤¾à¤°! à¤¹à¤® à¤…à¤¹à¤¾à¤à¤• à¤¸à¥à¤®à¤¾à¤°à¥à¤Ÿ à¤•à¥ƒà¤·à¤¿ à¤¸à¤¹à¤¯à¥‹à¤—à¥€ à¤›à¥€à¥¤ à¤…à¤¹à¤¾à¤à¤• à¤•à¥€ à¤®à¤¦à¤¦ à¤šà¤¾à¤¹à¥€?",

    sat: "á±§á±©á±› á±Ÿá±ž! á±Ÿá±¢ á±Ÿá±«á±® á±¥á±¢á±Ÿá±¨á±› á± á±¨á±¤á±¥á±¤ á±¥á±Ÿá±­á±Ÿá±œ á± á±š á±µá±šá±ž á± á±Ÿá±± á±¢á±®à¥¤ á±Ÿá±¢ á±›á±® á±¦á±Ÿá±žá±›á±®?",

    ks: "Ø¢Ø¯Ø§Ø¨! Ù…ÙŽÛŒÚº ØªÙÛÙ†Ø¯Ù• Ø³Ù…Ø§Ø±Ù¹ Ø²Ø±Ø¹ÛŒ Ù…Ø¹Ø§ÙˆÙ† Ø¢ÛÙÙ…Û” Ø¢Ø¬ Ù…ÙŽÛŒÚº ØªÙÛÙ†Ø¯Ù• Ú©ÙŽØ³ Ø·Ø±Ø­ Ù…Ø¯Ø¯ Ú©Ø±Ù•Ù…ØŸ",

    ne: "à¤¨à¤®à¤¸à¥à¤¤à¥‡! à¤® à¤¤à¤ªà¤¾à¤ˆà¤‚à¤•à¥‹ à¤¸à¥à¤®à¤¾à¤°à¥à¤Ÿ à¤•à¥ƒà¤·à¤¿ à¤¸à¤¹à¤¾à¤¯à¤• à¤¹à¥à¤à¥¤ à¤® à¤¤à¤ªà¤¾à¤ˆà¤‚à¤²à¤¾à¤ˆ à¤•à¤¸à¤°à¥€ à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾ à¤—à¤°à¥à¤¨ à¤¸à¤•à¥à¤›à¥?",

    sd: "Ø³Ù„Ø§Ù…! Ù…Ø§Ù† ØªÙˆÙ‡Ø§Ù†Ø¬Ùˆ Ø³Ù…Ø§Ø±Ù½ Ø²Ø±Ø¹ÙŠ Ù…Ø¯Ø¯Ú¯Ø§Ø± Ø¢Ù‡ÙŠØ§Ù†Û” Ù…Ø§Ù† ØªÙˆÙ‡Ø§Ù†Ø¬ÙŠ ÚªÙŠØ¦Ù† Ù…Ø¯Ø¯ ÚªØ±ÙŠ Ø³Ú¯Ú¾Ø§Ù† Ù¿ÙˆØŸ",

    doi: "à¤¨à¤®à¤¸à¥à¤•à¤¾à¤°! à¤®à¥ˆ à¤¤à¥à¤¹à¤¾à¤¡à¤¼à¥€ à¤¸à¥à¤®à¤¾à¤°à¥à¤Ÿ à¤•à¥ƒà¤·à¤¿ à¤¸à¤¹à¤¾à¤¯à¤•à¥€ à¤¹à¤¾à¤‚à¥¤ à¤®à¥ˆ à¤¤à¥à¤¹à¤¾à¤¡à¤¼à¥€ à¤•à¥‡à¤¤à¥‡ à¤®à¤¦à¤¦ à¤•à¤° à¤¸à¤•à¤¦à¤¾ à¤¹à¤¾à¤‚?",

    kok: "à¤¨à¤®à¤¸à¥à¤•à¤¾à¤°! à¤¹à¤¾à¤‚à¤µ à¤¤à¥à¤®à¤šà¥‹ à¤¸à¥à¤®à¤¾à¤°à¥à¤Ÿ à¤•à¥ƒà¤·à¤¿ à¤¸à¤¹à¤¾à¤¯à¥à¤¯à¤•à¥¤ à¤¹à¤¾à¤‚à¤µ à¤¤à¥à¤®à¤•à¤¾ à¤•à¤¶à¥‡à¤‚ à¤®à¤¦à¤¤ à¤•à¤°à¥‚à¤‚à¤—?",

    mni: "ê¯ê¯£ê¯Œê¯¥ê¯Ž! ê¯‘ê¯£ê¯ê¯¤ ê¯‘ê¯©ê¯”ê¯£ê¯€ê¯ê¯¤ ê¯ê¯ƒê¯¥ê¯”ê¯  ê¯€ê¯­ê¯”ê¯¤ê¯ê¯¤ ê¯ê¯¥ê¯Œê¯¥ê¯¡ ê¯ê¯§ê¯—ê¯£ê¯›ê¯„ê¯¤à¥¤ ê¯‘ê¯©ê¯ê¯§ê¯—ê¯£ê¯› ê¯‡ê¯§ê¯”ê¯£?",

    ar: "Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠ Ø§Ù„Ø°ÙƒÙŠ. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ",

    brx: "à¤œà¤¹à¤°! à¤†à¤‚ à¤œà¥‹à¤‚ à¤¨à¥‹à¤‚à¤¥à¤¾à¤‚à¤–à¥Œ à¤«à¤¦à¤¾à¤‚à¤¨à¥‹à¤¥à¤¿ à¤—à¥‹à¤†à¤¨à¤¿ à¤¸à¥à¤®à¤¾à¤°à¥à¤Ÿ à¤«à¤¾à¤¸à¤² à¤¸à¤¹à¤¾à¤¯à¤•à¥¤",

    sa: "à¤¨à¤®à¤¸à¥à¤•à¤¾à¤°! à¤…à¤¹à¤‚ à¤­à¤µà¤¤à¤ƒ à¤¸à¥à¤®à¤¾à¤°à¥à¤Ÿ à¤•à¥ƒà¤·à¤¿-à¤¸à¤¹à¤¾à¤¯à¤•à¤ƒ à¤…à¤¸à¥à¤®à¤¿à¥¤ à¤•à¤¥à¤‚ à¤­à¤µà¤¤à¤ƒ à¤¸à¤¹à¤¾à¤¯à¤¾à¤‚ à¤•à¤°à¥Šà¤®à¤¿?"
};


// POPULATE DROPDOWN
document.addEventListener("DOMContentLoaded", () => {
    const selector = document.getElementById("languageSelector");

    LANGUAGES.forEach(lang => {
        const option = document.createElement("option");
        option.value = lang.code;
        option.textContent = lang.name;

        if (lang.code === "en") option.selected = true;

        selector.appendChild(option);
    });
});


// CHANGE GREETING ON LANGUAGE SWITCH
function changeLanguage(selectedLang) {
    document.getElementById("chatBox").innerHTML =
        `<p class="bot-msg">${TRANSLATIONS[selectedLang]}</p>`;
}



// CHAT SEND FUNCTION
async function sendChat() {
    const input = document.getElementById("userMessage");
    const msg = input.value.trim();
    if (!msg) return;

    appendChat(msg, null);
    input.value = "";

    const thinking = document.createElement("p");
    thinking.className = "bot-msg";
    thinking.id = "thinking";
    thinking.innerHTML = "...";
    document.getElementById("chatBox").appendChild(thinking);

    const lang = document.getElementById("languageSelector").value;

    const response = await fetch("/chatbot", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: msg, language: lang })
    });

    const data = await response.json();
    document.getElementById("thinking").remove();

    appendChat(null, data.reply);
}



// IMAGE SEND FUNCTION
async function sendImage() {
    const file = document.getElementById("chatImage").files[0];
    if (!file) return;

    appendChat("[Image Uploaded]", null);

    const proc = document.createElement("p");
    proc.className = "bot-msg";
    proc.id = "processing";
    proc.innerHTML = "...";
    document.getElementById("chatBox").appendChild(proc);

    let formData = new FormData();
    formData.append("file", file);

    const imgRes = await fetch("/dashboard", {
        method: "POST",
        body: formData,
        headers: { "X-Chat-Image": "true" }
    });

    const imgData = await imgRes.json();
    document.getElementById("processing").remove();

    const lang = document.getElementById("languageSelector").value;

    const res = await fetch("/chatbot", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ image_prediction: imgData.prediction, language: lang })
    });

    const final = await res.json();
    appendChat(null, final.reply);
}


// APPEND TO CHAT BOX
function appendChat(user, bot) {
    let box = document.getElementById("chatBox");

    if (user) {
        box.innerHTML += `<p class="user-msg">${user}</p>`;
    }
    if (bot) {
        box.innerHTML += `<p class="bot-msg">${bot.replace(/\n/g, "<br>")}</p>`;
    }

    box.scrollTop = box.scrollHeight;
}

</script>

</body>
</html>